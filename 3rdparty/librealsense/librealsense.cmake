include(FetchContent)

set(LIBREALSENSE_VERSION "2.39.0")
set(LIBREALSENSE_CMAKE_ARG_NAMES
    CMAKE_INSTALL_PREFIX
    CMAKE_BUILD_TYPE
    BUILD_SHARED_LIBS
    BUILD_EXAMPLES
    BUILD_UNIT_TESTS
    BUILD_GLSL_EXTENSIONS
    BUILD_GRAPHICAL_EXAMPLES
    BUILD_PYTHON_BINDINGS
    BUILD_WITH_CUDA
    )
set(LIBREALSENSE_CMAKE_ARG_VALUES
    <INSTALL_DIR>
    Release
    OFF
    OFF
    OFF
    OFF
    OFF
    ${BUILD_PYTHON_MODULE}
    ${BUILD_CUDA_MNODULE}
    )
if (CMAKE_SYSTEM_NAME STREQUAL "Darwin")
    list(APPEND LIBREALSENSE_CMAKE_ARG_NAMES BUILD_WITH_OPENMP HWM_OVER_XU)
    list(APPEND LIBREALSENSE_CMAKE_ARG_VALUES OFF OFF)
elseif (CMAKE_SYSTEM_NAME STREQUAL "Windows")
    list(APPEND LIBREALSENSE_CMAKE_ARG_NAMES BUILD_WITH_STATIC_CRT)
    list(APPEND LIBREALSENSE_CMAKE_ARG_VALUES ${STATIC_WINDOWS_RUNTIME})
endif ()

FetchContent_Declare(
    ext_librealsense
    PREFIX librealsense
    URL "https://github.com/IntelRealSense/librealsense/archive/v${LIBREALSENSE_VERSION}.zip"
    URL_HASH SHA256=64ca0c9eed0dce23bfe2502c7c8d02f71d0534e3cbe4e2c888380ccfb06d7970
)

set(MAIN_CMAKE_ARG_VALUES "")
foreach(RS_ARG_N RS_ARG_V IN ZIP_LISTS LIBREALSENSE_CMAKE_ARG_NAMES
        LIBREALSENSE_CMAKE_ARG_VALUES)
    list(APPEND MAIN_CMAKE_ARG_VALUES ${${RS_ARG_N}})
    set(${RS_ARG_N} ${RS_ARG_V} CACHE INTERNAL "")
endforeach()
FetchContent_MakeAvailable(ext_librealsense)
foreach(RS_ARG_N RS_ARG_V IN ZIP_LISTS LIBREALSENSE_CMAKE_ARG_NAMES
        MAIN_CMAKE_ARG_VALUES)
    set(${RS_ARG_N} ${RS_ARG_V} CACHE "" FORCE)
endforeach()

set(REALSENSE_LIBRARY realsense2)
ExternalProject_Get_Property( ext_librealsense INSTALL_DIR)
set(realsense2_INCLUDE_DIR ${INSTALL_DIR}/include/)
set(realsense2_LIBRARY_DIR ${INSTALL_DIR}/lib/)
